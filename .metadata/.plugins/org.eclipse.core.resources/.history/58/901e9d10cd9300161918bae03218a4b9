var ejs= require('ejs');
var mysql = require('mysql').createPool({
	host     : 'localhost', //host where mysql server is running
	user     : 'root', //user for the mysql application
	password : 'Bhavan@123', //password for the mysql application
	database : 'ebay', //database name
	port  : 3306 //port, it is 3306 by default for mysql 
	});
var log = require('./log');

function Pool()
{
    this.pool = [];
    for(var i=0; i < 50; ++i)
        this.pool.push(mysql.getConnection());
    this.last = 0;
}

Pool.prototype.get = function()
{
    var current = this.pool[this.last];
    this.last++;
    if (this.last == this.pool.length)
       this.last = 0;
    return current;
}

 //fetching the data from the sql server
 function fetchData(callback,sqlQuery)
 {
	 var p = new Pool();
	 console.log("\nSQL Query::"+sqlQuery);
	 var connection=getConnection();
	 console.log('Connection established');
	 p.get().query(sqlQuery, function(err, rows, fields) {
		 if(err){ 
			 console.log("ERROR: " + err.message);
			 log.warn('Error in query '+err.message);
				
			 callback(err, err.message);
			 }
		 else   {
			 // return err or result   
			 console.log("DB Results:"+rows);
			 callback(err, rows);
			 }
		 }); 
	 	console.log("\nConnection closed.."); 
	 	connection.release();
 	} 
 exports.fetchData=fetchData;