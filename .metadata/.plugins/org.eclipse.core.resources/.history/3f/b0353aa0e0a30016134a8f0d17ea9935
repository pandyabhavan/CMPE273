var mongo = require("./mongo");
var mongoURL = "mongodb://localhost:27017/login";

exports.checkLogin = function(msg, callback){
	// These two variables come from the form on
	// the views/login.hbs page
	var username = msg.username;
	var password = msg.password;
	console.log(username +" is the object");
	var res = {};

	mongo.connect(mongoURL, function(){
		console.log('Connected to mongo at: ' + mongoURL);
		var coll = mongo.collection('login');

		coll.findOne({"handle": username, "password":password}, function(err, user){
			if (user) {
				console.log('in if');
				// This way subsequent requests will know the user is logged in.
				res.code = "200";
				res.value = user;
				console.log(res);

			} else {
				console.log("returned false");
				res.code = "401";
				res.value = "Failed Login";
			}
			callback(null, res);
		});
	});
};